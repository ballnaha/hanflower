generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model category {
  id          String    @id
  name        String?   // Added optional if needed by some routes
  title       String
  subtitle    String?
  slug        String    @unique
  description String?   @db.Text
  image       String?
  isActive    Boolean   @default(true)
  priority    Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  product     product[]
}

model product {
  id                  String           @id
  sku                 String           @unique(map: "Product_sku_key")
  title               String
  slug                String           @unique(map: "Product_slug_key")
  type                String
  price               Decimal          @db.Decimal(10, 2)
  originalPrice       Decimal?         @db.Decimal(10, 2)
  discount            Int?
  priceVelvet         Decimal?         @db.Decimal(10, 2)
  originalPriceVelvet Decimal?         @db.Decimal(10, 2)
  description         String           @db.Text
  image               String
  stock               Int              @default(0)
  stockVelvet         Int              @default(0)
  priority            Int              @default(0)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  discountVelvet      Int?
  categoryId          String?
  hasQrCode           Boolean          @default(true)
  qrCodePrice         Decimal?         @db.Decimal(10, 2) @default(150.00)
  isNew               Boolean          @default(false)
  isBestSeller        Boolean          @default(false)
  valentineCards      ValentineCard[]
  orderitem           orderitem[]
  category            category?        @relation(fields: [categoryId], references: [id], map: "Product_categoryId_fkey")
  productdetail       productdetail[]
  productfeature      productfeature[]
  productshipping     productshipping[]
  productimage        productimage[]

  @@index([categoryId], map: "Product_categoryId_fkey")
}

model productdetail {
  id        String  @id @default(uuid())
  text      String
  productId String
  product   product @relation(fields: [productId], references: [id], onDelete: Cascade, map: "ProductDetail_productId_fkey")

  @@index([productId], map: "ProductDetail_productId_fkey")
}

model productfeature {
  id        String  @id @default(uuid())
  text      String
  productId String
  product   product @relation(fields: [productId], references: [id], onDelete: Cascade, map: "ProductFeature_productId_fkey")

  @@index([productId], map: "ProductFeature_productId_fkey")
}

model productimage {
  id        String  @id @default(uuid())
  url       String
  productId String
  product   product @relation(fields: [productId], references: [id], onDelete: Cascade, map: "ProductImage_productId_fkey")

  @@index([productId], map: "ProductImage_productId_fkey")
}

model productshipping {
  id        String  @id @default(uuid())
  text      String
  productId String
  product   product @relation(fields: [productId], references: [id], onDelete: Cascade, map: "ProductShipping_productId_fkey")

  @@index([productId], map: "ProductShipping_productId_fkey")
}

model order {
  id              String      @id
  orderNumber     String      @unique(map: "Order_orderNumber_key")
  customerName    String
  customerEmail   String
  customerPhone   String
  customerAddress String      @db.Text
  totalAmount     Decimal     @db.Decimal(10, 2)
  status          String      @default("pending")
  paymentStatus   String      @default("unpaid")
  paymentMethod   String?
  shippingMethod  String?
  shippingFee     Decimal     @default(0.00) @db.Decimal(10, 2)
  notes           String?     @db.Text
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  items           orderitem[]
}

model orderitem {
  id        String  @id
  orderId   String
  productId String
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  order     order   @relation(fields: [orderId], references: [id], onDelete: Cascade, map: "OrderItem_orderId_fkey")
  product   product @relation(fields: [productId], references: [id], map: "OrderItem_productId_fkey")

  @@index([orderId], map: "OrderItem_orderId_fkey")
  @@index([productId], map: "OrderItem_productId_fkey")
}

model user {
  id        String   @id
  username  String   @unique
  email     String?  @unique(map: "User_email_key")
  password  String
  name      String?
  role      String   @default("user")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model setting {
  key         String   @id
  value       String   @db.Text
  description String?
  updatedAt   DateTime @updatedAt
}

model coupon {
  id          String    @id @default(cuid())
  code        String    @unique
  discount    Float
  type        String    @default("fixed") // fixed, percent
  minSpend    Float     @default(0)
  maxDiscount Float?
  limit       Int?
  expireAt    DateTime?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model shippingmethod {
  id            String   @id @default(cuid())
  code          String   @unique
  name          String
  description   String?  @db.Text
  price         Decimal  @db.Decimal(10, 2)
  estimatedDays String?
  enabled       Boolean  @default(true)
  priority      Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ValentineCard {
  id              String   @id @default(cuid())
  slug            String   @unique
  jobName         String?  // Internal name for admin
  title           String
  openingText     String?
  greeting        String?
  subtitle        String?
  message         String?  @db.Text
  signer          String?
  backgroundColor String?  @default("#FFF0F3")
  status          String   @default("active") // active, inactive
  disabledAt      DateTime? // วันที่จะ disabled อัตโนมัติ (ถ้าไม่ใส่ = ไม่มีวันหมดอายุ)

  // Background Music (เลือกใช้ได้ทีละอันเท่านั้น - MP3 จะถูกใช้ก่อนถ้ามีทั้งคู่)
  backgroundMusicYoutubeId String?  // YouTube Video ID for background music
  backgroundMusicUrl       String?  @db.Text // Uploaded MP3 file URL
  
  // UI Customization
  swipeHintColor           String?  @default("white") // white, red
  swipeHintText            String?  @default("Swipe up")
  showGame                 Boolean  @default(true)
  campaignName             String?  @default("Valentine's") // For the footer card

  // Customer Contact Info (Optional)
  customerPhone            String?
  customerAddress          String?  @db.Text
  note                     String?  @db.Text

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  memories        ValentineMemory[]
  orderedProducts product[]
  scores          ValentineScore[]
}

model ValentineMemory {
  id        String   @id @default(cuid())
  cardId    String
  type      String   @default("image") // image, video, youtube, tiktok
  url       String   @db.Text
  caption   String?
  thumbnail String?  @db.Text
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  card ValentineCard @relation(fields: [cardId], references: [id], onDelete: Cascade)
}

model ValentineScore {
  id        String   @id @default(cuid())
  cardId    String
  playerId  String   // Unique player identifier (stored in localStorage)
  name      String   // Player display name
  score     Int
  createdAt DateTime @default(now())

  card ValentineCard @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([score])
}


