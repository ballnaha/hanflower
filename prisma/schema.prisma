generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model category {
  id          String    @id
  slug        String    @unique(map: "Category_slug_key")
  title       String
  subtitle    String
  description String
  image       String
  priority    Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  product     product[]
}

model order {
  id             String      @id
  customerName   String
  tel            String
  address        String      @db.Text
  note           String?     @db.Text
  subtotal       Decimal     @db.Decimal(10, 2)
  shippingCost   Decimal     @db.Decimal(10, 2)
  shippingMethod String
  discount       Decimal     @default(0.00) @db.Decimal(10, 2)
  grandTotal     Decimal     @db.Decimal(10, 2)
  paymentMethod  String      @default("bank_transfer")
  status         String      @default("PENDING")
  slipUrl        String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  email          String?
  adminNote      String?     @db.Text
  trackingNumber String?
  orderitem      orderitem[]
}

model orderitem {
  id        String  @id
  orderId   String
  productId String
  title     String
  price     Decimal @db.Decimal(10, 2)
  quantity  Int
  image     String?
  order     order   @relation(fields: [orderId], references: [id], onDelete: Cascade, map: "OrderItem_orderId_fkey")
  product   product @relation(fields: [productId], references: [id], map: "OrderItem_productId_fkey")

  @@index([orderId], map: "OrderItem_orderId_fkey")
  @@index([productId], map: "OrderItem_productId_fkey")
}

model product {
  id                  String           @id
  sku                 String           @unique(map: "Product_sku_key")
  title               String
  slug                String           @unique(map: "Product_slug_key")
  type                String
  price               Decimal          @db.Decimal(10, 2)
  originalPrice       Decimal?         @db.Decimal(10, 2)
  discount            Int?
  priceVelvet         Decimal?         @db.Decimal(10, 2)
  originalPriceVelvet Decimal?         @db.Decimal(10, 2)
  description         String           @db.Text
  image               String
  stock               Int              @default(0)
  stockVelvet         Int              @default(0)
  priority            Int              @default(0)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  discountVelvet      Int?
  categoryId          String?
  hasQrCode           Boolean          @default(true)
  qrCodePrice         Decimal?         @db.Decimal(10, 2) @default(150.00)
  orderitem           orderitem[]
  category            category?        @relation(fields: [categoryId], references: [id], map: "Product_categoryId_fkey")
  productdetail       productdetail[]
  productfeature      productfeature[]
  productimage        productimage[]

  @@index([categoryId], map: "Product_categoryId_fkey")
}

model productdetail {
  id        String  @id @default(uuid())
  text      String
  productId String
  product   product @relation(fields: [productId], references: [id], onDelete: Cascade, map: "ProductDetail_productId_fkey")

  @@index([productId], map: "ProductDetail_productId_fkey")
}

model productfeature {
  id        String  @id @default(uuid())
  text      String
  productId String
  product   product @relation(fields: [productId], references: [id], onDelete: Cascade, map: "ProductFeature_productId_fkey")

  @@index([productId], map: "ProductFeature_productId_fkey")
}

model productimage {
  id        String  @id @default(uuid())
  url       String
  productId String
  product   product @relation(fields: [productId], references: [id], onDelete: Cascade, map: "ProductImage_productId_fkey")

  @@index([productId], map: "ProductImage_productId_fkey")
}

model user {
  id        String   @id @default(uuid())
  username  String   @unique(map: "User_username_key")
  password  String
  role      String   @default("ADMIN")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model shippingmethod {
  id            String   @id @default(uuid())
  code          String   @unique
  name          String
  description   String?
  price         Decimal  @db.Decimal(10, 2)
  estimatedDays String?
  enabled       Boolean  @default(true)
  priority      Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model setting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model coupon {
  id          String    @id @default(uuid())
  code        String    @unique
  discount    Decimal   @db.Decimal(10, 2)
  type        String    @default("percent") // percent, fixed
  minSpend    Decimal?  @default(0.00) @db.Decimal(10, 2)
  maxDiscount Decimal?  @db.Decimal(10, 2)
  limit       Int?
  used        Int       @default(0)
  expireAt    DateTime?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// Valentine Models
model ValentineCard {
  id              String   @id @default(cuid())
  slug            String   @unique
  jobName         String?  // Internal name for admin
  title           String
  openingText     String?
  greeting        String?
  subtitle        String?
  message         String?  @db.Text
  signer          String?
  backgroundColor String?  @default("#FFF0F3")
  status          String   @default("active") // active, inactive
  disabledAt      DateTime? // วันที่จะ disabled อัตโนมัติ (ถ้าไม่ใส่ = ไม่มีวันหมดอายุ)

  // Background Music (เลือกใช้ได้ทีละอันเท่านั้น - MP3 จะถูกใช้ก่อนถ้ามีทั้งคู่)
  backgroundMusicYoutubeId String?  // YouTube Video ID for background music
  backgroundMusicUrl       String?  @db.Text // Uploaded MP3 file URL
  
  // UI Customization
  swipeHintColor           String?  @default("white") // white, red
  swipeHintText            String?  @default("Swipe to see more")
  showGame                 Boolean  @default(true)
  campaignName             String?  @default("Valentine's") // For the footer card

  // Customer Contact Info (Optional)
  customerPhone            String?
  customerAddress          String?  @db.Text
  note                     String?  @db.Text

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  memories        ValentineMemory[]
  orderedProducts ValentineProduct[]
  scores          ValentineScore[]
}

model ValentineScore {
  id        String   @id @default(cuid())
  cardId    String
  playerId  String   // persistent ID from localStorage
  name      String
  score     Int
  createdAt DateTime @default(now())

  card ValentineCard @relation(fields: [cardId], references: [id], onDelete: Cascade)

  @@unique([cardId, playerId])
  @@index([cardId])
  @@index([playerId])
  @@index([score(sort: Desc)])
}

model ValentineMemory {
  id        String   @id @default(cuid())
  cardId    String
  type      String   @default("image") // image, youtube, tiktok, video
  url       String   @db.Text
  caption   String?
  thumbnail String?  @db.Text
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  card ValentineCard @relation(fields: [cardId], references: [id], onDelete: Cascade)
}

// Valentine Catalog Models
model ValentineProduct {
  id            String   @id @default(cuid())
  name          String
  category      String   @default("General")
  price         Float
  originalPrice Float?   // For discount display
  description   String?  @db.Text
  image         String?  // Main image URL (will be used as thumbnail in list)
  isHot         Boolean  @default(false)
  isNew         Boolean  @default(false)
  status        String   @default("active") // active, inactive, out_of_stock
  order         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  images        ValentineProductImage[]
  cards         ValentineCard[]
}

model ValentineProductImage {
  id        String   @id @default(cuid())
  productId String
  url       String   @db.Text
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product ValentineProduct @relation(fields: [productId], references: [id], onDelete: Cascade)
}
